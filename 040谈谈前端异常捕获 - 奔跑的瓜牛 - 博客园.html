<html>
<head>
  <title>040谈谈前端异常捕获 - 奔跑的瓜牛 - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601568 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5027"/>
<h1>040谈谈前端异常捕获 - 奔跑的瓜牛 - 博客园</h1>

<div><span>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font-family:Helvetica, Verdana, Arial, sans-serif, &quot;Microsoft YaHei&quot;;font-size:15px;"><div style="color:rgb(0, 0, 0);background:rgb(210, 216, 222);text-size-adjust:none;font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;"><div><div style="text-align:left;overflow:hidden;min-width:auto;"><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div><div><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;background:rgb(255, 255, 255);border-radius:7px;box-shadow:rgb(167, 168, 173) 1px 1px 2px;"><div>
            <h1 style="margin:0px;padding:0px;clear:both;padding-left:5px;font-size:130%;font-weight:bold;border-bottom:1px solid rgb(153, 153, 153);float:left;line-height:2em;width:100%;">
                
<a href="https://www.cnblogs.com/chenwenhao/p/12184733.html" style="margin:0px;padding:0px;text-decoration:none;color:rgb(38, 174, 206);transition:all 0.4s linear 0s;">谈谈前端异常捕获</a>

            </h1>
            <div style="margin:0px;padding:0px;clear:both;"></div>
            <div style="margin:0px;border-bottom:1px solid rgb(204, 204, 204);padding:15px 2px 5px 5px;line-height:1.5;color:rgb(51, 51, 51);">
                
<div style="margin:0px;padding:0px;margin-bottom:20px;word-break:break-word;"><a name="_labelTop" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><div style="margin:0px;border:1px solid rgb(238, 238, 238);border-radius:8px;box-shadow:rgb(221, 221, 221) 0px 2px 4px;margin-bottom:20px;padding:4px 18px;"><p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:18px;"><b style="margin:0px;padding:0px;">目录</b></p><ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;"><li style="padding:0px;list-style:none;list-style-type:disc;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label0" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">为什么要捕获异常</a></li><li style="padding:0px;list-style:none;list-style-type:disc;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">异常捕获分类</a><ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;"><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_0" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">try...catch 的误区</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_1" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">window.onerror 不是万能的</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_2" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">window.addEventListener</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_3" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">Promise Catch</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_4" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">iframe 异常</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_5" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">Script error</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_6" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">崩溃和卡顿</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_7" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">VUE errorHandler</a></li><li style="padding:0px;list-style:none;list-style-type:circle;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label1_8" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">React 异常捕获</a></li></ul></li><li style="padding:0px;list-style:none;list-style-type:disc;margin:0.3em 0px;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_label2" style="margin:0px;padding:0px;color:rgb(61, 129, 238);font-size:15px;text-decoration:none;">总结</a></li></ul></div><div style="margin:0px;padding:0px;line-height:1;font-size:12px;"> </div>
    <p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">作为一个前端开发人员，每次看到浏览器控制台信息里面红通通的报错信息是不是都很紧张......不要怕，下面我们就来讨论一下前端的异常捕获。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">异常捕获，相对于其他知识点可能没那么被重视，特别是对于前端程序员。但不得不说，这又是一个不得不面对的知识点。</p>
<div style="margin:0px;padding:0px;text-align:right;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_labelTop" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">回到顶部</a><a name="_label0" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a></div><h3 style="color:rgb(255, 255, 255);box-shadow:rgb(210, 210, 210) 0px 2px 6px;border-radius:6px;background:rgb(113, 183, 177);font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px 20px;padding:10px;">为什么要捕获异常</h3>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">首先，我们为什么要进行异常捕获和上报呢？</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">正所谓百密一疏，用程序员的话来说就是：天下不存在没有bug的程序（不接受反驳    ）。即使经过各种测试，还是会存在十分隐蔽的bug，这种不可预见的问题只有通过完善的监控机制才能有效的减少其带来的损失。因此，对于最接近用户的前端来说，为了能<strong style="margin:0px;padding:0px;">远程定位问题、增强用户体验</strong>，异常的捕获和上报至关重要。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">目前市面上已经有一些非常完善的前端监控系统存在，如<a href="https://www.fundebug.com/" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">Fundebug</a>、<a href="https://www.bugsnag.com/" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">Bugsnag</a>等，虽然这些已经能做到帮我们实时监控生产环境的异常，但是如果我们不了解异常是如何产生的，又怎么能得心应手的定位并处理问题呢？</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">对于JS而言，我们面对的仅仅只是异常，异常的出现不会直接导致JS引擎崩溃，最多只是终止当前代码的执行。下面来解释一下这句话：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span><span style="margin:0px;padding:0px;">
  error <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 没定义过的变量，此处会报错</span>
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'永远不会执行'</span>);
</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span><span style="margin:0px;padding:0px;">
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'我继续执行'</span>)
</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="141" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/20200111180358.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="720"></img></p>
<div style="margin:0px;padding:0px;text-align:right;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_labelTop" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">回到顶部</a><a name="_label1" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a></div><h3 style="color:rgb(255, 255, 255);box-shadow:rgb(210, 210, 210) 0px 2px 6px;border-radius:6px;background:rgb(113, 183, 177);font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px 20px;padding:10px;">异常捕获分类</h3>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">这里我做了一个脑图归纳一些前端异常，不一定对，只是有个大概印象。如下：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="493" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/errortype2.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="1397"></img></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">下面就针对不同异常的捕获一一分析：</p>
<a name="_label1_0" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">try...catch 的误区</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try...catch</code>只能捕获到<strong style="margin:0px;padding:0px;">同步的运行时错误</strong>，对于语法和异步错误无能为力，捕获不到。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">1.同步运行时错误</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">try</span> {
  <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">let</span> name = <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'Jack'</span>;
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(nam);
} <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">catch</span>(e) {
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,e);
}
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">输出：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">捕获到异常： ReferenceError: nam is <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">not</span> <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">defined</span>
    <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">at</span> &lt;anonymous&gt;:<span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">3</span>:<span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">15</span>
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">2.不能捕获语法错误，我们修改一个代码，删掉一个单引号</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(228, 86, 73);">try</span> {
  <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">let</span> name = <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'Jack;
  console.log(nam);
} catch(e) {
  console.log('</span>捕获到异常：<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">',e);
}
</span></code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">输出：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">Uncaught <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">SyntaxError</span>: Invalid or unexpected token
</code></pre>
<blockquote style="border:2px solid rgb(239, 239, 239);margin:0px;line-height:1.6;background:url(https://www.cnblogs.com/skins/darkgreentrip/images/comment.gif) 25px 0px no-repeat;border-top:none;border-right:none;border-bottom:none;border-image:initial;border-left:4px solid rgb(203, 203, 203);background-image:none;background-color:rgb(248, 248, 248);padding:1px 20px;color:rgb(102, 102, 102);margin-top:20px;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">语法错误<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">SyntaxError</code>，不管是<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.error</code>还是<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try...catch</code>都没法捕获异常。但是不用担心，在你写好代码按下保存那一刻，编译器会帮你检查是否有语法错误，如果有错误有会有个很明显的红红的波浪线，把鼠标移上去就能看到报错信息。因此，面对<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">SyntaxError</code>语法错误，一定要小心小心再小心</p>
</blockquote>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">3.异步错误</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">try</span> {
  setTimeout(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">()</span> =&gt;</span> {
    <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">undefined</span>.map(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">v</span> =&gt;</span> v);
  }, <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">1000</span>)
} <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">catch</span>(e) {
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,e);
}
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">输出：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">Uncaught <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">TypeError</span>: Cannot read property <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'map'</span> <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">of</span> <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">undefined</span>
    at setTimeout (<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">anonymous</span>&gt;</span>:3:11)
</span></code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">可以看到，并没有捕获到异常。</p>
<a name="_label1_1" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">window.onerror 不是万能的</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">当JS运行时错误发生时，<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window</code> 会触发一个 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">ErrorEvent</code> 接口的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error</code> 事件，并执行 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror()</code> 。</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">/**
* <span style="margin:0px;padding:0px;color:rgb(128, 128, 128);">@param</span> {String}  message    错误信息
* <span style="margin:0px;padding:0px;color:rgb(128, 128, 128);">@param</span> {String}  source    出错文件
* <span style="margin:0px;padding:0px;color:rgb(128, 128, 128);">@param</span> {Number}  lineno    行号
* <span style="margin:0px;padding:0px;color:rgb(128, 128, 128);">@param</span> {Number}  colno    列号
* <span style="margin:0px;padding:0px;color:rgb(128, 128, 128);">@param</span> {Object}  error  Error对象（对象）
*/</span>

window.onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span><span style="margin:0px;padding:0px;">(message, source, lineno, colno, error)</span> </span>{
   console.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, source, lineno, colno, error});
}
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">1.同步运行时错误</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(<span style="margin:0px;padding:0px;">message, source, lineno, colno, error</span>) </span>{
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// message：错误信息（字符串）。</span>
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// source：发生错误的脚本URL（字符串）</span>
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// lineno：发生错误的行号（数字）</span>
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// colno：发生错误的列号（数字）</span>
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// error：Error对象（对象）</span>
    <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, source, lineno, colno, error});
}
UndefVar;
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">可以看到，我们捕获了异常：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="284" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/20200112191006.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="706"></img></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">2.语法错误</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">window.onerror = <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(message, <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">source</span>, lineno, colno, error) {
	console.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">source</span>, lineno, colno, error});
}
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">let</span> name = <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'Jack; // 少个单引号
</span></code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">控制台打印出了这样的异常：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">Uncaught <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">SyntaxError</span>: Invalid or unexpected token
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">可以看出，并没有捕获到异常。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">3.异步运行时错误</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(<span style="margin:0px;padding:0px;">message, source, lineno, colno, error</span>) </span>{
    <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, source, lineno, colno, error});
}
setTimeout(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">()</span> =&gt;</span> {
    UndefVar;
});
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">同样看到，我们捕获了异常：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="270" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/20200112191502.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="711"></img></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">4.网络请求的异常</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span><span style="margin:0px;padding:0px;">
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(<span style="margin:0px;padding:0px;">message, source, lineno, colno, error</span>) </span>{
    <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, source, lineno, colno, error});
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">return</span> <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">true</span>;
}
</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">img</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">src</span>=<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;./xxx.png&quot;</span>&gt;</span>
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">我们发现，不论是静态资源异常，或者接口异常，错误都无法捕获到。</p>
<blockquote style="border:2px solid rgb(239, 239, 239);margin:0px;line-height:1.6;background:url(https://www.cnblogs.com/skins/darkgreentrip/images/comment.gif) 25px 0px no-repeat;border-top:none;border-right:none;border-bottom:none;border-image:initial;border-left:4px solid rgb(203, 203, 203);background-image:none;background-color:rgb(248, 248, 248);padding:1px 20px;color:rgb(102, 102, 102);margin-top:20px;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">注意：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code> 函数只有在返回 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">true</code> 的时候，异常才不会向上抛出（浏览器接收后报红），否则即使是知道异常的发生控制台还是会显示 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Uncaught Error: xxxxx</code></p>
</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code> 最好写在所有JS脚本的前面，否则有可能捕获不到错误</p>
</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code>无法捕获语法错误</p>
</li>
</ul>
</blockquote>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">那么问题来了，如何捕获静态资源加载错误呢？</p>
<a name="_label1_2" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">window.addEventListener</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">当一项资源（如图片和脚本加载失败），加载资源的元素会触发一个<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Event</code>接口的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error</code>事件，并执行该元素上的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">onerror</code>处理函数。这些<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error</code>事件不会向上冒泡到<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window</code>， 不过（至少在 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Chrome</code> 中）能被单一的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener</code> 捕获。</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span><span style="margin:0px;padding:0px;">
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.addEventListener(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'error'</span>, (error) =&gt; {
	<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>, error);
}, <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">true</span>)
</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">img</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">src</span>=<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;./xxxx.png&quot;</span>&gt;</span>
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">可以捕获异常：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="375" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/20200112193703.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="720"></img></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">由于网络请求异常不会事件冒泡，因此必须在捕获阶段将其捕捉到才行，但是这种方式虽然可以捕捉到网络请求的异常，但是无法判断 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">HTTP</code> 的状态是 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">404</code> 还是其他比如 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">500</code> 等等，所以还需要配合服务端日志才进行排查分析才可以。</p>
<blockquote style="border:2px solid rgb(239, 239, 239);margin:0px;line-height:1.6;background:url(https://www.cnblogs.com/skins/darkgreentrip/images/comment.gif) 25px 0px no-repeat;border-top:none;border-right:none;border-bottom:none;border-image:initial;border-left:4px solid rgb(203, 203, 203);background-image:none;background-color:rgb(248, 248, 248);padding:1px 20px;color:rgb(102, 102, 102);margin-top:20px;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">注意：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">不同浏览器下返回的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error</code> 对象可能不同，需要注意兼容处理。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">需要注意避免 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener</code> 重复监听。</li>
</ul>
</blockquote>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">到此为止，我们学到了：在开发的过程中，对于容易出错的地方，可以使用<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try{}catch(){}</code>来进行错误的捕获，做好兜底处理，避免页面挂掉。而对于全局的错误捕获，在现代浏览器中，我倾向于只使用使用<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener('error')</code>，<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener('unhandledrejection')</code>就行了。如果需要考虑兼容性，需要加上<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code>，三者同时使用，<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener('error')</code>专门用来捕获资源加载错误。</p>
<a name="_label1_3" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">Promise Catch</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">我们知道，在 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code> 中使用 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">catch</code> 可以非常方便的捕获到异步 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error</code>  。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">没有写<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">catch</code>的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code>中抛出的错误无法被<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">onerror</code>或<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try...catch</code>捕获到，所以务必在<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code>中写<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">catch</code>做异常处理。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">有没有一个全局捕获<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code>的异常呢？答案是有的。 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Uncaught Promise Error</code>就能做到全局监听，使用方式：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.addEventListener(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;unhandledrejection&quot;</span>, <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(<span style="margin:0px;padding:0px;">e</span>)</span>{
  <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// e.preventDefault(); // 阻止异常向上抛出</span>
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>, e);
});
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">Promise</span>.reject(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'promise error'</span>);
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">同样可以捕获错误：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><img height="436" src="https://raw.githubusercontent.com/cwh2407606301/picBed/master/img/20200112195302.png" style="margin:0px;padding:0px;border:0px;height:auto;max-width:100%;" width="707"></img></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">所以，正如我们上面所说，为了防止有漏掉的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code> 异常，建议在全局增加一个对 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">unhandledrejection</code> 的监听，用来全局监听 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Uncaught Promise Error</code>。</p>
<a name="_label1_4" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">iframe 异常</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">对于 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">iframe</code> 的异常捕获，我们还得借力 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code>：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span>(<span style="margin:0px;padding:0px;">message, source, lineno, colno, error</span>) </span>{
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到异常：'</span>,{message, source, lineno, colno, error});
}
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">下面一个简单的例子：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">iframe</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">src</span>=<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;./iframe.html&quot;</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">frameborder</span>=<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;0&quot;</span>&gt;</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">iframe</span>&gt;</span>
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span><span style="margin:0px;padding:0px;">
  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.frames[<span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">0</span>].onerror = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span> (<span style="margin:0px;padding:0px;">message, source, lineno, colno, error</span>) </span>{
    <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">console</span>.log(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'捕获到 iframe 异常：'</span>, {message, source, lineno, colno, error});
  };
</span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
</code></pre>
<a name="_label1_5" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">Script error</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">在进行错误捕获的过程中，很多时候并不能拿到完整的错误信息，得到的仅仅是一个<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">&quot;Script Error&quot;</code>。</p>
<h5 style="padding:0px;font-weight:bold;font-size:16px;margin:20px 0px 15px;color:rgb(0, 0, 0);">产生原因</h5>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">由于12年前这篇文章里提到的安全问题：<a href="https://blog.jeremiahgrossman.com/2006/12/i-know-if-youre-logged-in-anywhere.html%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BB%AC%E9%83%BD%E5%AF%B9%E5%86%85%E6%A0%B8%E8%BF%9B%E8%A1%8C%E4%BA%86%E5%8D%87%E7%BA%A7%EF%BC%9A" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">blog.jeremiahgrossman.com/2006/12/i-k…</a></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><strong style="margin:0px;padding:0px;">当加载自不同域的脚本中发生语法错误时，为避免信息泄露，语法错误的细节将不会报告，而是使用简单的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">&quot;Script error.&quot;</code>代替</strong>。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">一般而言，页面的JS文件都是放在CDN的，和页面自身的URL产生了跨域问题，所以引起了<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">&quot;Script Error&quot;</code>。</p>
<h5 style="padding:0px;font-weight:bold;font-size:16px;margin:20px 0px 15px;color:rgb(0, 0, 0);">解决办法</h5>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">一般情况，如果出现 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Script error</code> 这样的错误，基本上可以确定是跨域问题。这时候，是不会有其他太多辅助信息的，但是解决思路无非如下：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">跨源资源共享机制( <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">CORS</code> )：我们为 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">script</code> 标签添加 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">crossOrigin</code> 属性。</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">src</span>=<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">&quot;http://jartto.wang/main.js&quot;</span> <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">crossorigin</span>&gt;</span><span style="margin:0px;padding:0px;"></span><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">script</span>&gt;</span>
</code></pre>
<a name="_label1_6" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">崩溃和卡顿</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">卡顿也就是网页暂时响应比较慢， JS可能无法及时执行。但崩溃就不一样了，网页都崩溃了，JS都不运行了，还有什么办法可以监控网页的崩溃，并将网页崩溃上报呢？</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">1.利用 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window</code> 对象的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">load</code> 和 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">beforeunload</code> 事件实现了网页崩溃的监控。<br style="margin:0px;padding:0px;"/>
不错的文章，推荐阅读：<a href="http://jasonjl.me/blog/2015/06/21/taking-action-on-browser-crashes/" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">Logging Information on Browser Crashes</a>。</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.addEventListener(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'load'</span>, <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span> (<span style="margin:0px;padding:0px;"></span>) </span>{
    sessionStorage.setItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'good_exit'</span>, <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'pending'</span>);
    setInterval(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span> (<span style="margin:0px;padding:0px;"></span>) </span>{
        sessionStorage.setItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'time_before_crash'</span>, <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">new</span> <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">Date</span>().toString());
    }, <span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">1000</span>);
  });

  <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">window</span>.addEventListener(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'beforeunload'</span>, <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span> (<span style="margin:0px;padding:0px;"></span>) </span>{
    sessionStorage.setItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'good_exit'</span>, <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'true'</span>);
  });

  <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">if</span>(sessionStorage.getItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'good_exit'</span>) &amp;&amp;
    sessionStorage.getItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'good_exit'</span>) !== <span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'true'</span>) {
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">/*
        insert crash logging code here
    */</span>
    alert(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'Hey, welcome back from your crash, looks like you crashed on: '</span> + sessionStorage.getItem(<span style="margin:0px;padding:0px;color:rgb(80, 161, 79);">'time_before_crash'</span>));
  }
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">2.基于以下原因，我们可以使用 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Service Worker</code> 来实现<a href="https://juejin.im/entry/5be158116fb9a049c6434f4a?utm_source=gold_browser_extension" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">网页崩溃的监控</a>：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Service Worker</code> 有自己独立的工作线程，与网页区分开，网页崩溃了，<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Service Worker</code>一般情况下不会崩溃</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Service Worker</code> 生命周期一般要比网页还要长，可以用来监控网页的状态</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">网页可以通过 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">navigator.serviceWorker.controller.postMessage API</code> 向掌管自己的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">SW</code> 发送消息</li>
</ul>
<a name="_label1_7" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">VUE errorHandler</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">在Vue中，异常可能被Vue自身给<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try...catch</code>了，不会传到<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code>事件触发。不过不用担心，Vue提供了特有的异常捕获，比如Vux2.x中我们可以这样用：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;">Vue.config.errorHandler = <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">function</span> (<span style="margin:0px;padding:0px;">err, vm, info</span>) </span>{
	<span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">let</span> { 
	    message, <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常信息</span>
	    name, <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常名称</span>
	    script,  <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常脚本url</span>
	    line,  <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常行号</span>
	    column,  <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常列号</span>
	    stack  <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// 异常堆栈信息</span>
	} = err;
	
	<span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// vm为抛出异常的 Vue 实例</span>
	<span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// info为 Vue 特定的错误信息，比如错误所在的生命周期钩子</span>
}
</code></pre>
<a name="_label1_8" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a><h4 style="padding:0px;font-weight:bold;padding-bottom:10px;border-bottom:1px solid rgb(214, 205, 205);font-size:18px;margin:25px 0px 20px;color:rgb(0, 0, 0);">React 异常捕获</h4>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">在React，可以使用<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">ErrorBoundary</code>组件包括业务组件的方式进行异常捕获，配合<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">React 16.0+</code>新出的<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">componentDidCatch API</code>，可以实现统一的异常捕获和日志上报。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">我们来举一个小例子，在下面这个 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">componentDIdCatch(error,info)</code> 里的类会变成一个 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error boundary</code>：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">class</span> <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">ErrorBoundary</span> <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">extends</span> <span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">React</span>.<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">Component</span> </span>{
  constructor(props) {
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">super</span>(props);
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">this</span>.state = { hasError: <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">false</span> };
  }
 
  componentDidCatch(error, info) {
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// Display fallback UI</span>
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">this</span>.setState({ hasError: <span style="margin:0px;padding:0px;color:rgb(1, 132, 187);">true</span> });
    <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// You can also log the error to an error reporting service</span>
    logErrorToMyService(error, info);
  }
 
  render() {
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">if</span> (<span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">this</span>.state.hasError) {
      <span style="margin:0px;padding:0px;color:rgb(160, 161, 167);">// You can render any custom fallback UI</span>
      <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">return</span> &lt;h1&gt;<span style="margin:0px;padding:0px;color:rgb(0, 134, 179);">Something</span> went wrong.&lt;/h1&gt;;
    }
    <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">return</span> <span style="margin:0px;padding:0px;color:rgb(221, 17, 68);">this</span>.props.children;
  }
}
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">然后我们像使用普通组件那样使用它：</p>
<pre style="white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;margin-top:10px;margin-bottom:10px;position:relative;"><span style="margin:0px;position:absolute;top:2px;right:0px;border-radius:2px;font-size:12px;color:rgb(213, 205, 205);cursor:pointer;padding:0px 10px;">复制</span><code style="height:auto;margin:auto;vertical-align:bottom;display:block;overflow-x:auto;color:rgb(51, 51, 51);border:1px solid rgb(204, 204, 204);border-color:rgb(248, 248, 248);background:rgb(248, 248, 248);padding:15px 10px;line-height:1.68;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;border-radius:2px;"><span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">ErrorBoundary</span>&gt;</span>  
	<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">MyWidget</span> /&gt;</span>
<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">&lt;/<span style="margin:0px;padding:0px;color:rgb(51, 51, 51);">ErrorBoundary</span>&gt;</span>
</code></pre>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">componentDidCatch()</code> 方法像JS的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">catch{}</code> 模块一样工作，但是对于组件，只有 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">class</code> 类型的组件(<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">class component</code> )可以成为一个 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error boundaries</code> 。</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">实际上，大多数情况下我们可以在整个程序中定义一个 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error boundary</code> 组件，之后就可以一直使用它了！</p>
<blockquote style="border:2px solid rgb(239, 239, 239);margin:0px;line-height:1.6;background:url(https://www.cnblogs.com/skins/darkgreentrip/images/comment.gif) 25px 0px no-repeat;border-top:none;border-right:none;border-bottom:none;border-image:initial;border-left:4px solid rgb(203, 203, 203);background-image:none;background-color:rgb(248, 248, 248);padding:1px 20px;color:rgb(102, 102, 102);margin-top:20px;">
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">需要注意的是：<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error boundaries</code>并不会捕捉下面这些错误：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;padding-left:0px;margin-left:20px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">事件处理器</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">异步代码</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">服务端的渲染代码</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">在 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">error boundaries</code> 区域内的错误</li>
</ul>
</blockquote>
<div style="margin:0px;padding:0px;text-align:right;"><a href="https://www.cnblogs.com/chenwenhao/p/12184733.html#_labelTop" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">回到顶部</a><a name="_label2" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;"></a></div><h3 style="color:rgb(255, 255, 255);box-shadow:rgb(210, 210, 210) 0px 2px 6px;border-radius:6px;background:rgb(113, 183, 177);font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px 20px;padding:10px;">总结</h3>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">可疑区域增加 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">try...catch</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">全局监控JS异常： <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.onerror</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">全局监控静态资源异常： <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.addEventListener</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">全局捕获没有 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">catch</code> 的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">promise</code> 异常：<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">unhandledrejection</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">iframe 异常：<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window.error</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">VUE errorHandler</code> 和 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">React componentDidCatch</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">监控网页崩溃：<code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">window</code> 对象的 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">load</code> 和 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">beforeunload</code></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;"><code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">Script Error</code>跨域 <code style="display:inline-block;margin:1px 5px;color:rgb(255, 80, 44);line-height:1.6;vertical-align:bottom;border:1px solid rgb(204, 204, 204);border-radius:3px;border-color:rgb(248, 248, 248);font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:0.87em;background-color:rgb(255, 245, 245);padding:0.065em 0.4em;">crossOrigin</code> 解决</li>
</ol>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;">参考：</p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><a href="https://juejin.im/post/5c2d60616fb9a049dc025c39" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">前端开发中的Error以及异常捕获</a></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><a href="http://jartto.wang/2018/11/20/js-exception-handling/" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">如何优雅处理前端异常?</a></p>
<p style="padding:0px;text-indent:0px;margin:10px auto;line-height:1.74;font-size:14px;"><a href="https://mp.weixin.qq.com/s/BX0kb9HgPABi9LD9Q27Bbw" style="margin:0px;padding:0px;color:rgb(61, 129, 238);text-decoration:none;">一道不一样的前端架构师最终面试题</a></p>

</div>

<div style="margin:0px;padding:0px;clear:both;"></div>
<div style="margin:0px;padding:0px;margin-top:20px;"><div style="margin:0px;padding:0px;margin-bottom:10px;">
    分类: 
            <a href="https://www.cnblogs.com/chenwenhao/category/989333.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">JavaScript</a></div>


    <div style="margin:0px;padding:0px;">
<div style="margin:0px;margin-bottom:10px;margin-top:10px;border:1px dashed rgb(192, 192, 192);font-size:12px;text-align:center;padding:10px 0px;width:320px;">
        <a href="#" style="margin:0px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;display:inline-block;font-weight:bold;cursor:pointer;margin-right:10px;border-radius:10px;box-shadow:rgba(0, 0, 0, 0.5) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.25) 0px -1px 1px;vertical-align:middle;padding:3px 8px;text-decoration:none;background-color:rgb(45, 174, 191);border:none;color:rgb(255, 255, 255);">好文要顶</a>
        <a href="#" style="margin:0px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;display:inline-block;font-weight:bold;cursor:pointer;margin-right:10px;border-radius:10px;box-shadow:rgba(0, 0, 0, 0.5) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.25) 0px -1px 1px;vertical-align:middle;padding:3px 8px;text-decoration:none;background-color:rgb(227, 49, 0);border:none;color:rgb(255, 255, 255);">关注我</a>
    <a href="#" style="margin:0px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;display:inline-block;font-weight:bold;cursor:pointer;margin-right:10px;border-radius:10px;box-shadow:rgba(0, 0, 0, 0.5) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.25) 0px -1px 1px;vertical-align:middle;padding:3px 8px;text-decoration:none;background-color:rgb(255, 181, 21);border:none;color:rgb(255, 255, 255);">收藏该文</a>
    <a href="#" style="margin:0px;display:inline-block;font-weight:bold;cursor:pointer;margin-right:10px;border-radius:10px;vertical-align:middle;text-decoration:none;background:none;box-shadow:none;text-shadow:none;padding:3px 2px;border:none;color:rgb(255, 255, 255);" title="分享至新浪微博"><img src="040谈谈前端异常捕获 - 奔跑的瓜牛 - 博客园_files/icon_weibo_24.png" type="image/png" data-filename="icon_weibo_24.png" height="24" style="margin:0px;padding:0px;height:auto;vertical-align:middle;margin-left:5px;box-shadow:none;border:none;max-width:300px;" width="24"/></a>
    <a href="#" style="margin:0px;display:inline-block;font-weight:bold;cursor:pointer;margin-right:10px;border-radius:10px;vertical-align:middle;text-decoration:none;background:none;box-shadow:none;text-shadow:none;padding:3px 2px;border:none;color:rgb(255, 255, 255);" title="分享至微信"><img src="040谈谈前端异常捕获 - 奔跑的瓜牛 - 博客园_files/wechat.png" type="image/png" data-filename="wechat.png" height="24" style="margin:0px;padding:0px;width:24px;box-shadow:none;margin-left:5px;vertical-align:middle;height:24px;border:medium none;max-width:300px;" width="24"/></a>
</div>
<div style="margin:0px;padding:0px;float:left;width:280px;margin-top:0px;margin-bottom:10px;color:rgb(0, 0, 0);margin-left:0px;font-size:12px;">
    <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="https://home.cnblogs.com/u/chenwenhao/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"><img src="040谈谈前端异常捕获 - 奔跑的瓜牛 - 博客园_files/20170627215414.png" type="image/jpeg" data-filename="20170627215414.png" height="48" style="margin:0px;padding:0px;height:auto;vertical-align:top;float:left;margin-right:5px;padding-top:5px;padding-left:2px;border:0px;max-width:300px;" width="48"/></a>
        <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="https://home.cnblogs.com/u/chenwenhao/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">奔跑的瓜牛</a><br style="margin:0px;padding:0px;"/>
            <a href="https://home.cnblogs.com/u/chenwenhao/followees/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">关注 - 5</a><br style="margin:0px;padding:0px;"/>
            <a href="https://home.cnblogs.com/u/chenwenhao/followers/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">粉丝 - 88</a>
        </div>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;"></div>
    <div style="margin:0px;padding:0px;">
                <a href="#" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">+加关注</a>
    </div>
</div>
<div style="margin:0px;padding:0px;float:right;margin-bottom:10px;margin-right:30px;font-size:12px;width:125px;text-align:center;margin-top:10px;">
    <div style="margin:0px;padding:0px;float:left;width:46px;height:52px;background:url(https://static.cnblogs.com/images/upup.gif) no-repeat;text-align:center;cursor:pointer;margin-top:2px;padding-top:5px;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">1</span>
    </div>
    <div style="margin:0px;padding:0px;float:right;margin-left:20px;width:46px;height:52px;background:url(https://static.cnblogs.com/images/downdown.gif) no-repeat;text-align:center;cursor:pointer;margin-top:2px;padding-top:5px;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">0</span>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;margin-top:5px;margin-left:0px;font-size:12px;color:rgb(128, 128, 128);">
    </div>
</div>

</div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;line-height:1.8;font-size:12px;">

    <a href="https://www.cnblogs.com/chenwenhao/p/12153332.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:none;">« </a> 上一篇：    <a href="https://www.cnblogs.com/chenwenhao/p/12153332.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" title="发布于 2020-01-05 19:49">前端模块化——彻底搞懂AMD、CMD、ESM和CommonJS</a>
    <br style="margin:0px;padding:0px;"/>
    <a href="https://www.cnblogs.com/chenwenhao/p/12354176.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:none;">» </a> 下一篇：    <a href="https://www.cnblogs.com/chenwenhao/p/12354176.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" title="发布于 2020-02-23 21:08">JS设计模式——策略模式</a>

</div>
</div>
            </div>
            <div style="margin:0px;padding:0px;clear:both;line-height:2.5em;margin-top:5px;float:right;width:100%;text-align:right;padding-right:5px;color:rgb(102, 102, 102);">posted @ 
<span style="margin:0px;padding:0px;">2020-01-12 21:28</span> 
<a href="https://www.cnblogs.com/chenwenhao/" style="margin:0px;padding:0px;text-decoration:none;color:rgb(102, 102, 102);">奔跑的瓜牛</a> 
阅读(<span style="margin:0px;padding:0px;">369</span>) 
评论(<span style="margin:0px;padding:0px;">0</span>) 
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=12184733" rel="nofollow" style="margin:0px;padding:0px;text-decoration:none;color:rgb(102, 102, 102);">编辑</a> 
<a href="#" style="margin:0px;padding:0px;text-decoration:none;color:rgb(102, 102, 102);">收藏</a></div>
        </div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 